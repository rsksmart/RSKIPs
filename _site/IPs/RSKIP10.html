<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Transactions never invalidate blocks | RSK Improvement Proposals</title>
    <meta
      property="og:title"
      content="Transactions never invalidate blocks | RSK Improvement Proposals"
    />
    <meta name="description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />

  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="https://ips.rsk.co/IPs/RSKIP10" />
  <meta property="og:url" content="https://ips.rsk.co/IPs/RSKIP10" />
  <meta property="og:site_name" content="RSK Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "https://ips.rsk.co",
      "name": "RSK Improvement Proposals",
      "description": "RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" />
      <!-- Google Fonts -->
      <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700,900&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,600,700,800&display=swap" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="RSK Improvement Proposals" /><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script>
</head>
<body><header class="site-header" role="banner">
  <button id="dark-mode-toggle" class="dark-mode-toggle theme-toggle-button">
    <svg class="icon" style="width:24px;height:24px" viewBox="0 0 24 24">
      <path fill="currentColor" d="M7.5,2C5.71,3.15 4.5,5.18 4.5,7.5C4.5,9.82 5.71,11.85 7.53,13C4.46,13 2,10.54 2,7.5A5.5,5.5 0 0,1 7.5,2M19.07,3.5L20.5,4.93L4.93,20.5L3.5,19.07L19.07,3.5M12.89,5.93L11.41,5L9.97,6L10.39,4.3L9,3.24L10.75,3.12L11.33,1.47L12,3.1L13.73,3.13L12.38,4.26L12.89,5.93M9.59,9.54L8.43,8.81L7.31,9.59L7.65,8.27L6.56,7.44L7.92,7.35L8.37,6.06L8.88,7.33L10.24,7.36L9.19,8.23L9.59,9.54M19,13.5A5.5,5.5 0 0,1 13.5,19C12.28,19 11.15,18.6 10.24,17.93L17.93,10.24C18.6,11.15 19,12.28 19,13.5M14.6,20.08L17.37,18.93L17.13,22.28L14.6,20.08M18.93,17.38L20.08,14.61L22.28,17.15L18.93,17.38M20.08,12.42L18.94,9.64L22.28,9.88L20.08,12.42M9.63,18.93L12.4,20.08L9.87,22.27L9.63,18.93Z" />
    </svg>
  </button>


<div class="wrapper"><a class="site-title" rel="author" href="/">RSK Improvement Proposals</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link underline" href="/all">All</a><a class="page-link underline" href="/scalability">Scalability</a><a class="page-link underline" href="/security">Security</a><a class="page-link underline" href="/usability">Usability</a><a class="page-link underline" href="/fairness">Fairness</a><a class="page-link underline" href="/standardtrack">Standard Track</a></div>





      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Transactions never invalidate blocks</h1>
  </header>

  <div class="post-content">
    <h1 id="transactions-never-invalidate-blocks">Transactions never invalidate blocks</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Transactions never invalidate blocks</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">21-OCT-2016</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Sca</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Accepted</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>This RSKIP defines a reorganization of fields in the RSK block header and a change in the semantics of transaction execution to allow nodes to decide if a block is valid without executing any transaction in the block.</p>

<h1 id="motivation"><strong>Motivation</strong></h1>

<p>An e-invalid block is defined as a block with correct PoW but is considered invalid by consensus rules when its transactions are executed. It is generally considered that the attack of creating e-invalid blocks is expensive because miners have to invest electricity to build a block that passes the PoW check. That same amount of electricity could have been spent to mine a block containing a reward, and therefore the attack has at least the cost of electricity and the loss of the block reward. As RSK blockchain is merge-mined, mining RSK blocks have very little additional electricity cost. The block reward will be low during an initial period of the platform. Therefore, in RSK, the miners could try to perform attacks that are normally economically discouraged in other blockchains. Miners that do not participate in the normal merge-mining of RSK could decide to attack the RSK blockchain by mining invalid blocks. Since RSK is planning to improve the network latency by propagating the header plus the transactions IDs (see RSKIP58), the attacker can force the whole network invest CPU resources in partial validation, and force miners to work on invalid parent blocks, if “SPV mining” is used. A single attack has no longstanding consequences, but if sustained, an attack can delay the creation of honest blocks.</p>

<p>This discussion assumes that each block defines a minimum gas price (minGasPrice, as defined by [RSKIP09]).</p>

<h1 id="specification"><strong>Specification</strong></h1>

<p>When a block is propagated, it is propagated with all transactions so that the txTrieRoot can be validated.</p>

<p>This RSKIP proposes the following changes:</p>

<ol>
  <li>Verification-less mining is implemented, as described in RSKIP08.</li>
  <li>If a transaction does not have enough balance to cover its gas or value transfer specifications, then the transaction is skipped, along with all transactions following the flawed one. However, the block is valid, and can be added to the blockchain.</li>
  <li>The block header includes a new field: prevTxValidCount, which indicate how many transactions in the previous block were valid (all must be consecutive and the counter starts at the first transaction).</li>
</ol>

<p>To help header-first propagation, the following additional rules are applied:</p>

<p><em>RULE 1</em>. The maximum block size is limited to gasLimit/68. <a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP06.md">RSKIP06</a></p>

<p><em>RULE 2</em>. The zero discount rule in the data field is removed.  <a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP06.md">RSKIP06</a></p>

<p><em>RULE 3</em>. The block header includes a new field TxCount that specifies the number of transactions in the block.</p>

<p><em>RULE 4</em>. The maximum number of transactions per block is set to gasLimit/21000</p>

<p>The rule 2 prevents a miner from filling a block with transactions without funds, which cannot even pay the cost of block minGastPrice. The miner/attacker can only put a single flawed transaction. The receipt tree must not take into account invalid transactions.</p>

<p>The underlying principle of this design is that once the block header is verified and transactions have been verified to be syntactically correct, the block is valid.</p>

<h2 id="side-effects">Side-effects</h2>

<p>This change has some side-effects that should be taken into account. SPV wallets can be given proofs that point to transactions which are being skipped, but the SPV client has no way to detect this.
The way to prevent this is that the following block must include the number of transactions from the previous block that have been actually processed correctly (rule 3).
Therefore a SPV proof will include a following header, and SPV clients would need to check it.
Another side effect is that if the miner can include invalid transactions, then nothing prevents the miner from including a huge number of them. There are two ways to prevent this:</p>

<ol>
  <li>Transactions are stored in the leaves of a Merkle tree. The first invalid transactions is left, but the following are removed from the tree and from storage.</li>
</ol>

<p>This does not prevent the invalid transaction to contain a huge amount of data in the “data” field.</p>

<ol>
  <li>We limit the maximum size of a block</li>
</ol>

<p>This is what RSKIP06 does (rule 5).</p>

<h2 id="other-competing-proposals">Other Competing Proposals</h2>

<p><a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP58.md">RSKIP58</a> presents a header-first block propagation method that does not require verification-less mining and allows arbitrary transaction inclusion. 
<a href="https://github.com/rsksmart/RSKIPs/blob/master/IPs/RSKIP58.md">RSKIP58</a> consumes more bandwidth than this RSKIP, and therefore delays the propagation of blocks compared to RSKIP56, however RSKIP58 is superior because 
it does not require all the modifications to the block header presented in this RSKIP.</p>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer>
    <div class="footer_cont">
        <div class="footer_box">
            <ul class="social-media-list"><li><a href="https://github.com/rsksmart/RSKIPs" target="_blank" rel="noopener"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Visit on Github</span></a></li></ul>
        </div>
    </div>
</footer><script src="../assets/js/dark_mode.js"></script>
    <script src="../../assets/js/dark_mode.js"></script>
  </body>

</html>
