<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Precompiled Contracts for BLS12-381 Curve Operations | RSK Improvement Proposals</title>
    <meta
      property="og:title"
      content="Precompiled Contracts for BLS12-381 Curve Operations | RSK Improvement Proposals"
    />
    <meta name="description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />

  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="https://ips.rsk.co/IPs/RSKIP188" />
  <meta property="og:url" content="https://ips.rsk.co/IPs/RSKIP188" />
  <meta property="og:site_name" content="RSK Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "https://ips.rsk.co",
      "name": "RSK Improvement Proposals",
      "description": "RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" />
      <!-- Google Fonts -->
      <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700,900&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,600,700,800&display=swap" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="RSK Improvement Proposals" /><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script>
</head>
<body><header class="site-header" role="banner">
  <button id="dark-mode-toggle" class="dark-mode-toggle theme-toggle-button">
    <svg class="icon" style="width:24px;height:24px" viewBox="0 0 24 24">
      <path fill="currentColor" d="M7.5,2C5.71,3.15 4.5,5.18 4.5,7.5C4.5,9.82 5.71,11.85 7.53,13C4.46,13 2,10.54 2,7.5A5.5,5.5 0 0,1 7.5,2M19.07,3.5L20.5,4.93L4.93,20.5L3.5,19.07L19.07,3.5M12.89,5.93L11.41,5L9.97,6L10.39,4.3L9,3.24L10.75,3.12L11.33,1.47L12,3.1L13.73,3.13L12.38,4.26L12.89,5.93M9.59,9.54L8.43,8.81L7.31,9.59L7.65,8.27L6.56,7.44L7.92,7.35L8.37,6.06L8.88,7.33L10.24,7.36L9.19,8.23L9.59,9.54M19,13.5A5.5,5.5 0 0,1 13.5,19C12.28,19 11.15,18.6 10.24,17.93L17.93,10.24C18.6,11.15 19,12.28 19,13.5M14.6,20.08L17.37,18.93L17.13,22.28L14.6,20.08M18.93,17.38L20.08,14.61L22.28,17.15L18.93,17.38M20.08,12.42L18.94,9.64L22.28,9.88L20.08,12.42M9.63,18.93L12.4,20.08L9.87,22.27L9.63,18.93Z" />
    </svg>
  </button>


<div class="wrapper"><a class="site-title" rel="author" href="/">RSK Improvement Proposals</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link underline" href="/all">All</a><a class="page-link underline" href="/scalability">Scalability</a><a class="page-link underline" href="/security">Security</a><a class="page-link underline" href="/usability">Usability</a><a class="page-link underline" href="/fairness">Fairness</a><a class="page-link underline" href="/standardtrack">Standard Track</a></div>





      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Precompiled Contracts for BLS12-381 Curve Operations</h1>
  </header>

  <div class="post-content">
    <h1 id="precompiled-contracts-for-bls12-381-curve-operations">Precompiled Contracts for BLS12-381 Curve Operations</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">188</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Precompiled Contracts for BLS12-381 Curve Operations</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">20-11-2020</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">FJ</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Usa</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Draft</td>
    </tr>
  </tbody>
</table>

<h2 id="abstract">Abstract</h2>

<p>In order to mantain Ethereum compatibility, we introducue a set of precompiled contracts. Enabling efficient operations on BLS12-381 curve, in a necessary set for BLS signature verifications and SNARKs verifications.</p>

<h3 id="proposed-addresses-table">Proposed addresses table</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Precompile</th>
      <th style="text-align: right">Address</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">BLS12_G1ADD</td>
      <td style="text-align: right">0x0a</td>
    </tr>
    <tr>
      <td style="text-align: left">BLS12_G1MUL</td>
      <td style="text-align: right">0x0b</td>
    </tr>
    <tr>
      <td style="text-align: left">BLS12_G1MULTIEXP</td>
      <td style="text-align: right">0x0c</td>
    </tr>
    <tr>
      <td style="text-align: left">BLS12_G2ADD</td>
      <td style="text-align: right">0x0d</td>
    </tr>
    <tr>
      <td style="text-align: left">BLS12_G2MUL</td>
      <td style="text-align: right">0x0e</td>
    </tr>
    <tr>
      <td style="text-align: left">BLS12_G2MULTIEXP</td>
      <td style="text-align: right">0x0f</td>
    </tr>
    <tr>
      <td style="text-align: left">BLS12_PAIRING</td>
      <td style="text-align: right">0x10</td>
    </tr>
    <tr>
      <td style="text-align: left">BLS12_MAP_FP_TO_G1</td>
      <td style="text-align: right">0x11</td>
    </tr>
    <tr>
      <td style="text-align: left">BLS12_MAP_FP2_TO_G2</td>
      <td style="text-align: right">0x12</td>
    </tr>
  </tbody>
</table>

<h2 id="motivation">Motivation</h2>

<p>Motivation of this precompile:</p>
<ul>
  <li>Mantain compatibility between RSK and Ethereum</li>
  <li>Add a cryptographic primitive that allows to get 120+ bits of security for operations over pairing friendly curve compared to the existing BN254 precompile that only provides 80 bits of security.</li>
</ul>

<h2 id="specification">Specification</h2>

<p>If <code class="language-plaintext highlighter-rouge">blockNumber &gt;= N</code> (to be defined) we introduce nine separate precompiles to perform the following operations:</p>

<p><code class="language-plaintext highlighter-rouge">BLS12_G1ADD</code> - to perform point addition on a curve defined over prime field
<code class="language-plaintext highlighter-rouge">BLS12_G1MUL</code> - to perform point multiplication on a curve defined over prime field
<code class="language-plaintext highlighter-rouge">BLS12_G1MULTIEXP</code> - to perform multiexponentiation on a curve defined over prime field
<code class="language-plaintext highlighter-rouge">BLS12_G2ADD</code> - to perform point addition on a curve twist defined over quadratic extension of the base field
<code class="language-plaintext highlighter-rouge">BLS12_G2MUL</code> - to perform point multiplication on a curve twist defined over quadratic extension of the base field
<code class="language-plaintext highlighter-rouge">BLS12_G2MULTIEXP</code> - to perform multiexponentiation on a curve twist defined over quadratic extension of the base field
<code class="language-plaintext highlighter-rouge">BLS12_PAIRING</code> - to perform a pairing operations between a set of pairs of (G1, G2) points
<code class="language-plaintext highlighter-rouge">BLS12_MAP_FP_TO_G1</code> - maps base field element into the G1 point
<code class="language-plaintext highlighter-rouge">BLS12_MAP_FP2_TO_G2</code> - maps extension field element into the G2 point</p>

<p>Mapping functions are implemented according to IEFT specification version <code class="language-plaintext highlighter-rouge">v7</code>(!) using an simplified SWU method. It does NOT perform mapping of the byte string into field element that can be implemented in many different ways and can be efficiently performed in EVM, but only does field arithmetic to map field element into curve point. Such functionality is required for signature schemes.</p>

<p>Multiexponentiation operation is included to efficiently aggregate public keys or individual signer’s signatures during BLS signature verification.</p>

<p>The rest of the specification it’s described at <a href="https://eips.ethereum.org/EIPS/eip-2537">EIP-2537</a></p>

<h2 id="rationale">Rationale</h2>

<p>Motivation section covers a total motivation to have operations over BLS12-381 curve available. We also extend a rationale for move specific fine points.</p>

<p>Multiexponentiation as a separate call</p>

<p>Explicit separate multiexponentiation operation that allows one to save execution time (so gas) by both the algorithm used (namely Peppinger algorithm) and (usually forgotten) by the fact that <code class="language-plaintext highlighter-rouge">CALL</code> operation in Ethereum is expensive (at the time of writing), so one would have to pay non-negigible overhead if e.g. for multiexponentiation of <code class="language-plaintext highlighter-rouge">100</code> points would have to call the multipication precompile <code class="language-plaintext highlighter-rouge">100</code> times and addition for <code class="language-plaintext highlighter-rouge">99</code> times (roughly <code class="language-plaintext highlighter-rouge">138600</code> would be saved).</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>There are no backward compatibility questions.</p>

<h2 id="test-cases">Test Cases</h2>

<p>Due to the large test parameters space we first provide properties that various operations must satisfy. We use additive notation for point operations, capital letters (P, Q) for points, small letters (a, b) for scalars. Generator for G1 is labeled as G, generator for G2 is labeled as H, otherwise we assume random point on a curve in a correct subgroup. 0 means either scalar zero or point of infinity. 1 means either scalar one or multiplicative identity. group_order is a main subgroup order. e(P, Q) means pairing operation where P is in G1, Q is in G2.</p>

<h3 id="requeired-properties-for-basic-ops-addmultiply">Requeired properties for basic ops (add/multiply):</h3>

<ul>
  <li>Commutativity: <code class="language-plaintext highlighter-rouge">P + Q = Q + P</code></li>
  <li>Additive negation: <code class="language-plaintext highlighter-rouge">P + (-P) = 0</code></li>
  <li>Doubling: <code class="language-plaintext highlighter-rouge">P + P = 2*P</code></li>
  <li>Subgroup check: <code class="language-plaintext highlighter-rouge">group_order * P = 0</code></li>
  <li>Trivial multiplication check: <code class="language-plaintext highlighter-rouge">1 * P = P</code></li>
  <li>Multiplication by zero: <code class="language-plaintext highlighter-rouge">0 * P = 0</code></li>
  <li>Multiplication by the unnormalized scalar: <code class="language-plaintext highlighter-rouge">(scalar + group_order) * P = scalar * P</code></li>
</ul>

<h3 id="required-properties-for-pairing-operation">Required properties for pairing operation:</h3>
<ul>
  <li>Degeneracy: <code class="language-plaintext highlighter-rouge">e(P, 0*Q) = e(0*P, Q) = </code>1</li>
  <li>Bilinearity: <code class="language-plaintext highlighter-rouge">e(a*P, b*Q) = e(a*b*P, Q) = e(P, a*b*Q)</code> (internal test, not visible through ABI)</li>
</ul>

<p>Test vector for all operations are expanded in this csv files in repo.</p>

<h2 id="references">References</h2>

<p>[1] <a href="https://eips.ethereum.org/EIPS/eip-2537">EIP-2537</a></p>

<h3 id="copyright">Copyright</h3>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer>
    <div class="footer_cont">
        <div class="footer_box">
            <ul class="social-media-list"><li><a href="https://github.com/rsksmart/RSKIPs" target="_blank" rel="noopener"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Visit on Github</span></a></li></ul>
        </div>
    </div>
</footer><script src="../assets/js/dark_mode.js"></script>
    <script src="../../assets/js/dark_mode.js"></script>
  </body>

</html>
