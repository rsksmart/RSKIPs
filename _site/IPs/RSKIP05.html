<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Shift Operations | RSK Improvement Proposals</title>
    <meta
      property="og:title"
      content="Shift Operations | RSK Improvement Proposals"
    />
    <meta name="description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards." />

  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="https://ips.rsk.co/IPs/RSKIP05" />
  <meta property="og:url" content="https://ips.rsk.co/IPs/RSKIP05" />
  <meta property="og:site_name" content="RSK Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "https://ips.rsk.co",
      "name": "RSK Improvement Proposals",
      "description": "RSK Improvement Proposals (RSKIPs) describe standards for the RSK platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" />
      <!-- Google Fonts -->
      <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700,900&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,600,700,800&display=swap" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="RSK Improvement Proposals" /><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script>
</head>
<body><header class="site-header" role="banner">
  <button id="dark-mode-toggle" class="dark-mode-toggle theme-toggle-button">
    <svg class="icon" style="width:24px;height:24px" viewBox="0 0 24 24">
      <path fill="currentColor" d="M7.5,2C5.71,3.15 4.5,5.18 4.5,7.5C4.5,9.82 5.71,11.85 7.53,13C4.46,13 2,10.54 2,7.5A5.5,5.5 0 0,1 7.5,2M19.07,3.5L20.5,4.93L4.93,20.5L3.5,19.07L19.07,3.5M12.89,5.93L11.41,5L9.97,6L10.39,4.3L9,3.24L10.75,3.12L11.33,1.47L12,3.1L13.73,3.13L12.38,4.26L12.89,5.93M9.59,9.54L8.43,8.81L7.31,9.59L7.65,8.27L6.56,7.44L7.92,7.35L8.37,6.06L8.88,7.33L10.24,7.36L9.19,8.23L9.59,9.54M19,13.5A5.5,5.5 0 0,1 13.5,19C12.28,19 11.15,18.6 10.24,17.93L17.93,10.24C18.6,11.15 19,12.28 19,13.5M14.6,20.08L17.37,18.93L17.13,22.28L14.6,20.08M18.93,17.38L20.08,14.61L22.28,17.15L18.93,17.38M20.08,12.42L18.94,9.64L22.28,9.88L20.08,12.42M9.63,18.93L12.4,20.08L9.87,22.27L9.63,18.93Z" />
    </svg>
  </button>


<div class="wrapper"><a class="site-title" rel="author" href="/">RSK Improvement Proposals</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link underline" href="/all">All</a><a class="page-link underline" href="/scalability">Scalability</a><a class="page-link underline" href="/security">Security</a><a class="page-link underline" href="/usability">Usability</a><a class="page-link underline" href="/fairness">Fairness</a><a class="page-link underline" href="/standardtrack">Standard Track</a></div>





      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Shift Operations</h1>
  </header>

  <div class="post-content">
    <h1 id="shift-operations">Shift Operations</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RSKIP</th>
      <th style="text-align: left">05</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Title</strong></td>
      <td style="text-align: left">Shift Operations</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Created</strong></td>
      <td style="text-align: left">22-JUN-2016</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Author</strong></td>
      <td style="text-align: left">SDL</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Purpose</strong></td>
      <td style="text-align: left">Sca</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Layer</strong></td>
      <td style="text-align: left">Core</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Complexity</strong></td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Status</strong></td>
      <td style="text-align: left">Accepted</td>
    </tr>
  </tbody>
</table>

<h1 id="abstract"><strong>Abstract</strong></h1>

<p>The EVM lack shift operations. Although shift operations can be carried on using MUL / DIV, shift operations should be much less expensive. An example of use of the shift operation is in ABI parsing, where the method id must be extracted. Currently this is performed by DIV.</p>

<h1 id="motivation"><strong>Motivation</strong></h1>

<p>Allow optimization of contracts that do bit-manipulation.</p>

<p>There are two related opcodes (rotate) that are often present in modern CPU. However there is no clear use case for RROTATE and LROTATE for 256-bit arithmetic. There could be specific opcodes for 32-bit or 64-bit rotation, as some cryptographic primitives requires it.</p>

<p>This must be further researched.</p>

<p><strong>Important Update</strong></p>

<p>As of december 2016, the Ethereum team created their own specification for the same requirement.</p>

<p>It can be seen here. The solidity compiler has also been modified to support these opcodes.</p>

<p><a href="https://github.com/ethereum/EIPs/issues/145">https://github.com/ethereum/EIPs/issues/145</a></p>

<p>The full EIP can be seen here:</p>

<p><a href="https://github.com/axic/EIPs/blob/4bab8793ed119e445b6c9e69d9250bdede176bc7/EIPS/eip-draft_bitwise_shifts.md">https://github.com/axic/EIPs/blob/4bab8793ed119e445b6c9e69d9250bdede176bc7/EIPS/eip-draft_bitwise_shifts.md</a></p>

<h1 id="specification"><strong>Specification</strong></h1>

<p>This section has been replaced by a literal copy of the EIP.</p>

<h2 id="preamble"><strong>Preamble</strong></h2>

<p>EIP: <to be="" assigned="">
Title: Bitwise shifting instructions in EVM
Author: Alex Beregszaszi, Pawe≈Ç Bylica
Type: Standard Track
Category Core
Status: Draft
Created: 2017-02-13</to></p>

<h2 id="simple-summary"><strong>Simple Summary</strong></h2>

<p>To provide native bitwise shifting with cost on par with other arithmetic operations.</p>

<h2 id="abstract-1"><strong>Abstract</strong></h2>

<p>Native bitwise shifting instructions are introduced, which are more efficient processing wise on the host and are cheaper to user by a contract.</p>

<h2 id="motivation-1"><strong>Motivation</strong></h2>

<p>EVM is lacking bitwise shifting operators, but supports other logical and arithmetic operators. Shift operations can be implemented via arithmetic operators, but that has a higher cost and requires more processing time from the host. Implementing SHL and SHR using arithmetics cost each 35 gas, while the proposed instructions take 3 gas.</p>

<h2 id="specification-1"><strong>Specification</strong></h2>

<p>The following instructions are introduced:</p>

<h3 id="0x1b--shl-shift-left"><strong>0x1b</strong> : <strong>SHL</strong> <strong>(shift left)</strong></h3>

<p>The SHL instruction (shift left) pops 2 values from the stack, arg1 and arg2, and pushes on the stack the second popped value arg2 shifted to the left by the number of bits in the first popped value arg1. The result is equal to</p>

<p>(arg2 * 2^arg1) mod 2^256</p>

<p>Notes:</p>

<ul>
  <li>If the shift amount is greater or equal 256 the result is 0.</li>
</ul>

<h3 id="0x1c--shr-logical-shift-right"><strong>0x1c</strong> : <strong>SHR</strong> <strong>(logical shift right)</strong></h3>

<p>The SHR instruction (logical shift right) pops 2 values from the stack, arg1 and arg2, and pushes on the stack the second popped value arg2 shifted to the right by the number of bits in the first popped value arg1 with zero fill. The result is equal to</p>

<p>arg2 udiv 2^arg1</p>

<p>Notes:</p>

<ul>
  <li>If the shift amount is greater or equal 256 the result is 0.</li>
</ul>

<h3 id="0x1d--sar-arithmetic-shift-right"><strong>0x1d</strong> : <strong>SAR</strong> <strong>(arithmetic shift right)</strong></h3>

<p>The SAR instruction (arithmetic shift right) pops 2 values from the stack, arg1 and arg2, and pushes on the stack the second popped value arg2 shifted to the right by the number of bits in the first popped value arg1 with sign extension. The result is equal to</p>

<p>arg2 sdiv 2^arg1</p>

<p>Notes:</p>

<ul>
  <li>
    <p>arg1 is interpreted as unsigned number.</p>
  </li>
  <li>
    <p>If the shift amount is greater or equal 256 the result is 0 if arg2 is non-negative or -1 if arg2 is negative.</p>
  </li>
</ul>

<h3 id="0x1e--rol-rotate-left"><strong>0x1e</strong> : <strong>ROL</strong> <strong>(rotate left)</strong></h3>

<p>The ROL instruction (rotate left) pops 2 values from the stack, arg1 and arg2, and pushes on the stack the second popped value arg2 circular shifted to the left by the number of bits in the first popped value arg1.</p>

<p>(arg1 shl arg2) or (arg1 shr (256 - arg2)</p>

<p>Notes:</p>

<ul>
  <li>arg2 rol arg1 is equivalent of arg2 rol (arg1 mod 2^256)</li>
</ul>

<h3 id="0x1f--ror-rotate-right"><strong>0x1f</strong> : <strong>ROR</strong> <strong>(rotate right)</strong></h3>

<p>The ROL instruction (rotate right) pops 2 values from the stack, arg1 and arg2, and pushes on the stack the second popped value arg2 circular shifted to the right by the number of bits in the first popped value arg1.</p>

<p>(arg1 shr arg2) or (arg1 shl (256 - arg2)</p>

<p>Notes:</p>

<ul>
  <li>arg2 ror arg1 is equivalent of arg2 ror (arg1 mod 2^256)</li>
</ul>

<p>The cost of the shift instructions is set at verylow tier (3 gas), while the rotations are 12 gas each.</p>

<h1 id="rationale"><strong>Rationale</strong></h1>

<p>Instruction operands were chosen to match the other logical and arithmetic instructions.</p>

<h1 id="backwards-compatibility"><strong>Backwards Compatibility</strong></h1>

<p>The newly introduced instructions have no effect on bytecode created in the past.</p>

<h1 id="test-cases"><strong>Test Cases</strong></h1>

<p>TBA</p>

<h1 id="implementation"><strong>Implementation</strong></h1>

<p>Client support: TBA</p>

<p>Compiler support:</p>

<ul>
  <li>Solidity: <a href="https://github.com/ethereum/solidity/tree/asm-bitshift">https://github.com/ethereum/solidity/tree/asm-bitshift</a></li>
</ul>

<h1 id="copyright"><strong>Copyright</strong></h1>

<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>


  </div>

</article>

      </div>
    </main><footer>
    <div class="footer_cont">
        <div class="footer_box">
            <ul class="social-media-list"><li><a href="https://github.com/rsksmart/RSKIPs" target="_blank" rel="noopener"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Visit on Github</span></a></li></ul>
        </div>
    </div>
</footer><script src="../assets/js/dark_mode.js"></script>
    <script src="../../assets/js/dark_mode.js"></script>
  </body>

</html>
